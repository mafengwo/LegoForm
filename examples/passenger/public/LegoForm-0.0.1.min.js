/*
 * LegoForm
 * 
 *
 * Version: 0.0.1 - 2016-06-27
 * License: MIT
 */angular.module("LegoForm",["lf.tpls","lf.service.form","lf.service.model","lf.service.validation","lf.lego.checkbox","lf.lego.form","lf.lego.input","lf.lego.radio","lf.lego.submit","lf.lego.textarea"]),angular.module("lf.tpls",["lf/checkbox.html","lf/form.html","lf/input.html","lf/radio.html","lf/submit.html","lf/textarea.html"]),angular.module("lf.service.form",[]).service("formService",["validationService","$rootScope",function(a,b){function c(a){var b=a.data_type.toLowerCase(),c=a.default_value;if(c)return c;switch(b){case"string":return"";case"number":return 0;case"array":return[];case"object":return{}}}var d={},e=[];this.getLegoDef=function(){return e},this.getFormData=function(){return d},this.init=function(a,b){e=a,angular.forEach(a,function(a){b.hasOwnProperty(a.name)||(b[a.name]=c(a))}),d=b},this.validate=function(){a.validate(e,d)},this.submit=function(){b.$broadcast("lf.event.submit",d)}}]),angular.module("lf.service.model",[]).service("modelService",function(){var a,b,c,d={},e={};this.initModelDef=function(f,g){var h;d=_.indexBy(f,"id"),_.each(g,function(f,g){h=d[g],1===h.role&&(a=h.id),_.each(f,function(d){var f=[h.kind,d.column,h.id,d.id].join("$$");e[f]={col_id:d.id,column:d.column,model_id:h.id,kind:h.kind,relationship:h.relationship,role:h.role,default_value:d.column_data_default_value,data_type:d.column_data_type,key_type:d.column_key_type,one_with_more:1===h.relationship},a===h.id&&1==d.column_key_type&&(c=d.column,b=f)})})},this.getModelById=function(a){return d[a]},this.getPrimaryModelId=function(){return a},this.getPrimaryLegoName=function(){return b},this.getPrimaryColumnName=function(){return c},this.getSchemaByLegoName=function(a){return e[a]}}),angular.module("lf.service.validation",[]).service("validationService",function(){function a(a,b,c){var d;if(angular.isArray(b))for(d=0;d<b.length;d++)a=a.replace("{PARAM["+d+"]}",b[d]);else if(angular.isObject(b))for(d in b)b.hasOwnProperty(d)&&(a=a.replace("{PARAM."+d+"}",b[d]));else a=a.replace("{PARAM}",b);return["[LegoValidationError] Lego (",c.name,") ",a].join("")}this.validate=function(c,d){var e,f=[];return angular.forEach(c,function(c){var g=d[c.name],h=c.data_type.toLowerCase();angular.forEach(c,function(d,i){b.hasOwnProperty(i)&&(e=b[i].method(g,d,h),e||f.push({lego_name:c.name,message:a(b[i].message,d,c)}))})}),f};var b={data_type:{method:function(a,b){var c;if(b=b.toLowerCase(),-1!==["string","number","array","object"].indexOf(b))return c=["is",b.charAt(0).toUpperCase(),b.slice(1)].join(""),angular[c](a);throw Error("Unrecognized data_type of"+param)},message:"type should be {PARAM}"},required:{method:function(a,b,c){switch(c.toLowerCase()){case"string":return!!a.length;case"number":return a>0;case"array":return!!a.length;case"object":for(var d in a)if(a.hasOwnProperty(d))return!0;return!1}},message:"is required!"},min_length:{method:function(a,b,c){return-1!==["string","array"].indexOf(c)&&angular.isNumber(+b)?a.length>=b:!0},message:"min length is {PARAM}"},max_length:{method:function(a,b,c){return-1!==["string","array"].indexOf(c)&&angular.isNumber(+b)?a.length<=b:!0},message:"max length is {PARAM}"},range:{method:function(a,b,c){return"number"===c&&angular.isArray(b)&&2===b.length&&angular.isNumber(b[0])&&angular.isNumber(b[1])&&b[0]<=b[1]?b[0]<a&&a<b[1]:void 0},message:"value range is {PARAM[0]} - {PARAM[1]}"}}}),angular.module("lf.lego.checkbox",[]).controller("CheckboxController",["$scope",function(a){function b(){if(!angular.isArray(c.$modelValue))throw TypeError("The data type of lego-checkbox must be an array.")}var c;a.checkboxOptions||(a.checkboxOptions={}),this.init=function(a){c=a},a.check=function(a,d){if("INPUT"!==d.target.tagName)return!1;b();var e=c.$modelValue,f=e.indexOf(a.value);-1===f?e.push(a.value):e.splice(f,1),c.$setViewValue(e)},a.isChecked=function(a){return angular.isDefined(c.$modelValue)&&-1!==c.$modelValue.indexOf(a.value)}}]).directive("legoCheckbox",function(){return{require:["legoCheckbox","ngModel"],restrict:"E",scope:{checkboxOptions:"=?"},templateUrl:"lf/checkbox.html",controller:"CheckboxController",link:function(a,b,c,d){var e=d[0],f=d[1];e.init(f)}}}),angular.module("lf.lego.form",[]).controller("FormController",["$scope","formService",function(a,b){var c,d;this.setLegoDef=function(a){c=a,this.init()},this.setNgModel=function(a){d=a,this.init()},this.init=function(){c&&d&&b.init(c,d)}}]).directive("legoForm",function(){return{require:["legoForm","ngModel"],restrict:"E",scope:{legoDef:"=?",ngModel:"=?"},templateUrl:"lf/form.html",controller:"FormController",link:function(a,b,c,d){var e=d[0];a.$watch("legoDef",function(a){a&&angular.isArray(a)&&a.length>0&&e.setLegoDef(a)}),a.$watch("ngModel",function(a){a&&e.setNgModel(a)})}}}),angular.module("lf.lego.input",[]).controller("InputController",function(){var a;this.init=function(b){a=b}}).directive("legoInput",function(){return{require:["legoInput","ngModel"],restrict:"E",scope:{maxLength:"=?",ngModel:"=?"},templateUrl:"lf/input.html",controller:"InputController",link:function(a,b,c,d){var e=d[0],f=d[1];e.init(f)}}}),angular.module("lf.lego.radio",[]).controller("RadioController",["$scope",function(a){var b;a.radioOptions||(a.radioOptions={}),this.init=function(a){b=a},a.check=function(a,c){return"INPUT"!==c.target.tagName?!1:void b.$setViewValue(a.value)},a.isChecked=function(a){return b.$modelValue===a.value}}]).directive("legoRadio",function(){return{require:["legoRadio","ngModel"],restrict:"E",scope:{radioOptions:"=?"},templateUrl:"lf/radio.html",controller:"RadioController",link:function(a,b,c,d){var e=d[0],f=d[1];e.init(f)}}}),angular.module("lf.lego.submit",[]).controller("SubmitController",["$scope","formService",function(a,b){var c;this.init=function(a){c=a},a.submit=function(){b.submit()}}]).directive("legoSubmit",function(){return{require:["legoSubmit","ngModel"],restrict:"E",controller:"SubmitController",templateUrl:"lf/submit.html",link:function(a,b,c,d){var e=d[0],f=d[1];e.init(f)}}}),angular.module("lf.lego.textarea",[]).controller("TextareaController",["$scope","formService",function(a,b){var c;this.init=function(a){c=a}}]).directive("legoTextarea",function(){return{require:["legoTextarea","ngModel"],restrict:"E",scope:{maxLength:"=?",ngModel:"=?"},templateUrl:"lf/textarea.html",controller:"TextareaController",link:function(a,b,c,d){var e=d[0],f=d[1];e.init(f,c)}}}),angular.module("lf/checkbox.html",[]).run(["$templateCache",function(a){a.put("lf/checkbox.html",'<div class="lf-lego-checkbox">\n    <label class="item" ng-repeat="one in checkboxOptions" ng-click="check(one, $event)">\n        <input type="checkbox" ng-checked="isChecked(one)">\n        <span class="label" ng-bind="one.label"></span>\n    </label>\n</div>')}]),angular.module("lf/form.html",[]).run(["$templateCache",function(a){a.put("lf/form.html",'<form class="form">\n\n    <div ng-repeat="lego in legoDef" ng-switch="lego.type" class="form-group">\n\n        <label ng-bind="lego.label"></label>\n\n        <!-- input -->\n        <lego-input \n                ng-switch-when="input"\n                ng-model="ngModel[lego.name]"\n                max-length="lego.max_length"\n        ></lego-input>\n\n        <!-- radio -->\n        <lego-radio\n                ng-switch-when="radio"\n                ng-model="ngModel[lego.name]"\n                radio-options="lego.options"\n        ></lego-radio>\n\n        <!-- checkbox -->\n        <lego-checkbox\n                ng-switch-when="checkbox"\n                ng-model="ngModel[lego.name]"\n                checkbox-options="lego.options"\n                max-length="lego.max_length"\n        ></lego-checkbox>\n        \n        <!-- textarea -->\n        <lego-textarea\n                ng-switch-when="textarea"\n                ng-model="ngModel[lego.name]"\n                max-length="lego.max_length"\n        ></lego-textarea>\n    </div>\n\n    <lego-submit ng-model="ngModel"></lego-submit>\n</form>')}]),angular.module("lf/input.html",[]).run(["$templateCache",function(a){a.put("lf/input.html",'<input type="text" ng-model="ngModel" ng-change="change()" maxlength="{{maxLength}}" class="form-control">')}]),angular.module("lf/radio.html",[]).run(["$templateCache",function(a){a.put("lf/radio.html",'<div class="lf-lego-radio">\n    <label class="item" ng-repeat="one in radioOptions" ng-click="check(one, $event)">\n        <input type="radio" ng-checked="isChecked(one)">\n        <span class="label" ng-bind="one.label"></span>\n    </label>\n</div>')}]),angular.module("lf/submit.html",[]).run(["$templateCache",function(a){a.put("lf/submit.html",'<button class="btn btn-default" ng-click="submit()">\n    Submit\n</button>')}]),angular.module("lf/textarea.html",[]).run(["$templateCache",function(a){a.put("lf/textarea.html",'<textarea ng-model="ngModel" maxlength="{{maxLength}}" class="form-control"></textarea>')}]);